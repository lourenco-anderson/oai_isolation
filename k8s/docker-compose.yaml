version: '3.8'

services:
  # GNB Services
  gnb-crc:
    build:
      context: ../
      dockerfile: containers/gnb/crc/Dockerfile
    container_name: gnb-crc
    image: oai-isolation:gnb-crc
    ports:
      - "8080:8080"
    environment:
      - LOG_LEVEL=INFO
    restart: unless-stopped
    networks:
      - oai-network
    labels:
      component: gnb
      function: crc

  gnb-layer-map:
    build:
      context: ../
      dockerfile: containers/gnb/layer_map/Dockerfile
    container_name: gnb-layer-map
    image: oai-isolation:gnb-layer-map
    ports:
      - "8081:8080"
    environment:
      - LOG_LEVEL=INFO
    restart: unless-stopped
    networks:
      - oai-network
    depends_on:
      - gnb-crc
    labels:
      component: gnb
      function: layer-map

  gnb-ldpc:
    build:
      context: ../
      dockerfile: containers/gnb/ldpc/Dockerfile
    container_name: gnb-ldpc
    image: oai-isolation:gnb-ldpc
    ports:
      - "8082:8080"
    environment:
      - LOG_LEVEL=INFO
    restart: unless-stopped
    networks:
      - oai-network
    depends_on:
      - gnb-layer-map
    labels:
      component: gnb
      function: ldpc

  gnb-modulation:
    build:
      context: ../
      dockerfile: containers/gnb/modulation/Dockerfile
    container_name: gnb-modulation
    image: oai-isolation:gnb-modulation
    ports:
      - "8083:8080"
    environment:
      - LOG_LEVEL=INFO
    restart: unless-stopped
    networks:
      - oai-network
    depends_on:
      - gnb-ldpc
    labels:
      component: gnb
      function: modulation

  gnb-ofdm-mod:
    build:
      context: ../
      dockerfile: containers/gnb/ofdm_mod/Dockerfile
    container_name: gnb-ofdm-mod
    image: oai-isolation:gnb-ofdm-mod
    ports:
      - "8084:8080"
    environment:
      - LOG_LEVEL=INFO
    restart: unless-stopped
    networks:
      - oai-network
    depends_on:
      - gnb-modulation
    labels:
      component: gnb
      function: ofdm-mod

  gnb-precoding:
    build:
      context: ../
      dockerfile: containers/gnb/precoding/Dockerfile
    container_name: gnb-precoding
    image: oai-isolation:gnb-precoding
    ports:
      - "8085:8080"
    environment:
      - LOG_LEVEL=INFO
    restart: unless-stopped
    networks:
      - oai-network
    depends_on:
      - gnb-ofdm-mod
    labels:
      component: gnb
      function: precoding

  gnb-scramble:
    build:
      context: ../
      dockerfile: containers/gnb/scramble/Dockerfile
    container_name: gnb-scramble
    image: oai-isolation:gnb-scramble
    ports:
      - "8086:8080"
    environment:
      - LOG_LEVEL=INFO
    restart: unless-stopped
    networks:
      - oai-network
    depends_on:
      - gnb-precoding
    labels:
      component: gnb
      function: scramble

  # UE Services
  ue-ch-est:
    build:
      context: ../
      dockerfile: containers/ue/ch_est/Dockerfile
    container_name: ue-ch-est
    image: oai-isolation:ue-ch-est
    ports:
      - "9080:8080"
    environment:
      - LOG_LEVEL=INFO
    restart: unless-stopped
    networks:
      - oai-network
    labels:
      component: ue
      function: ch-est

  ue-ch-mmse:
    build:
      context: ../
      dockerfile: containers/ue/ch_mmse/Dockerfile
    container_name: ue-ch-mmse
    image: oai-isolation:ue-ch-mmse
    ports:
      - "9081:8080"
    environment:
      - LOG_LEVEL=INFO
    restart: unless-stopped
    networks:
      - oai-network
    depends_on:
      - ue-ch-est
    labels:
      component: ue
      function: ch-mmse

  ue-check-crc:
    build:
      context: ../
      dockerfile: containers/ue/check_crc/Dockerfile
    container_name: ue-check-crc
    image: oai-isolation:ue-check-crc
    ports:
      - "9082:8080"
    environment:
      - LOG_LEVEL=INFO
    restart: unless-stopped
    networks:
      - oai-network
    labels:
      component: ue
      function: check-crc

  ue-descrambling:
    build:
      context: ../
      dockerfile: containers/ue/descrambling/Dockerfile
    container_name: ue-descrambling
    image: oai-isolation:ue-descrambling
    ports:
      - "9083:8080"
    environment:
      - LOG_LEVEL=INFO
    restart: unless-stopped
    networks:
      - oai-network
    depends_on:
      - ue-check-crc
    labels:
      component: ue
      function: descrambling

  ue-layer-demap:
    build:
      context: ../
      dockerfile: containers/ue/layer_demap/Dockerfile
    container_name: ue-layer-demap
    image: oai-isolation:ue-layer-demap
    ports:
      - "9084:8080"
    environment:
      - LOG_LEVEL=INFO
    restart: unless-stopped
    networks:
      - oai-network
    depends_on:
      - ue-descrambling
    labels:
      component: ue
      function: layer-demap

  ue-ldpc-dec:
    build:
      context: ../
      dockerfile: containers/ue/ldpc_dec/Dockerfile
    container_name: ue-ldpc-dec
    image: oai-isolation:ue-ldpc-dec
    ports:
      - "9085:8080"
    environment:
      - LOG_LEVEL=INFO
    restart: unless-stopped
    networks:
      - oai-network
    depends_on:
      - ue-layer-demap
    labels:
      component: ue
      function: ldpc-dec

  ue-ofdm-demod:
    build:
      context: ../
      dockerfile: containers/ue/ofdm_demod/Dockerfile
    container_name: ue-ofdm-demod
    image: oai-isolation:ue-ofdm-demod
    ports:
      - "9086:8080"
    environment:
      - LOG_LEVEL=INFO
    restart: unless-stopped
    networks:
      - oai-network
    depends_on:
      - ue-ldpc-dec
    labels:
      component: ue
      function: ofdm-demod

  ue-soft-demod:
    build:
      context: ../
      dockerfile: containers/ue/soft_demod/Dockerfile
    container_name: ue-soft-demod
    image: oai-isolation:ue-soft-demod
    ports:
      - "9087:8080"
    environment:
      - LOG_LEVEL=INFO
    restart: unless-stopped
    networks:
      - oai-network
    depends_on:
      - ue-ofdm-demod
    labels:
      component: ue
      function: soft-demod

networks:
  oai-network:
    driver: bridge
    name: oai-network

# Uso:
# docker-compose up -d                     # Iniciar todos os containers
# docker-compose down                      # Parar todos os containers
# docker-compose logs -f <service>         # Ver logs de um servi√ßo
# docker-compose ps                        # Listar containers
